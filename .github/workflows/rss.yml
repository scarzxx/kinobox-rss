name: Generate RSS feeds for Kinobox

on:
  schedule:
    - cron: "0 */4 * * *"  # This cron job runs every 4 hours
  workflow_dispatch:  # Allows you to trigger this workflow manually from GitHub

jobs:
  update-feeds:
    name: Update RSS Feeds
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: write
      security-events: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v4  # Checkout k√≥du z repozit√°≈ôe

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r scripts/requirements.txt  # Instalace z√°vislost√≠

    - name: Generate RSS Feeds
      id: generate_rss_feeds
      env: # <--- Zde p≈ôid√°v√°me promƒõnn√© prost≈ôed√≠ z GitHub Secrets
        TMDB_API_KEY: ${{ secrets.TMDB_API_KEY }}
        TRAKT_CLIENT_ID: ${{ secrets.TRAKT_CLIENT_ID }}
        # Volitelnƒõ m≈Ø≈æete p≈ôidat i dal≈°√≠ promƒõnn√© prost≈ôed√≠ pro locale, pokud jsou opravdu pot≈ôeba
        # a p≈ôedchoz√≠ exporty nestaƒçily. Ale ƒçasto staƒç√≠ jen nastavit LANG a LC_ALL.
        LANG: en_US.UTF-8
        LC_ALL: en_US.UTF-8
      run: |
        # N√°sleduj√≠c√≠ ≈ô√°dky pro locale jsou vƒõt≈°inou zbyteƒçn√© v GitHub Actions,
        # proto≈æe prost≈ôed√≠ je ji≈æ nastaveno a sudo nen√≠ doporuƒçeno, pokud nen√≠ nezbytnƒõ nutn√©.
        # export LC_ALL="en_US.UTF-8"
        # export LC_CTYPE="en_US.UTF-8"
        # sudo dpkg-reconfigure locales
        
        # Spu≈°tƒõn√≠ va≈°ich Python skript≈Ø
        python scripts/kinobox_novinky_json.py
        python scripts/tmdb_popular.py
        # python scripts/tmdb_tv.py
        

    - name: Commit changes
      uses: stefanzweifel/git-auto-commit-action@v5  # Automatizovan√Ω commit
      with:
        commit_message: "üìùAktualizace RSS kan√°lu"  # Commit zpr√°va
        commit_options: "--no-gpg-sign"  # Bez GPG podpisu
        branch: main  # Commit na hlavn√≠ vƒõtev
